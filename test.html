<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Search Engine with Images</title>
<style>
body { font-family: Arial; text-align: center; margin-top: 50px; }
input { width: 300px; padding: 10px; font-size: 16px; }
.result { width: 70%; margin: 20px auto; text-align: left; padding: 10px; border-bottom: 1px solid #ddd; display: flex; align-items: center; }
.result img { border-radius: 8px; width: 50px; height: 50px; margin-right: 15px; }
.result-content { display: inline-block; }
.result a { color: blue; text-decoration: none; }
.result a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>Mini Search Engine with Images</h1>
<input type="text" id="query" placeholder="Search..." oninput="search()">

<div id="results"></div>

<script>
let dataCache = null;

// Hardcoded raw GitHub URL for JSON with 10 sites and 1000 keywords each
const jsonFile = "https://raw.githubusercontent.com/playerauth/index/refs/heads/main/index1.json";

// Load JSON data
async function loadData() {
  if (dataCache) return dataCache;
  try {
    const res = await fetch(jsonFile);
    if (!res.ok) throw new Error("HTTP error " + res.status);
    dataCache = await res.json();
    return dataCache;
  } catch (err) {
    console.error("Failed to load JSON:", err);
    document.getElementById("results").innerHTML = "Failed to load app.";
    return [];
  }
}

// Live search function (case-insensitive)
async function search() {
  const q = document.getElementById("query").value.trim().toLowerCase();
  const resultsDiv = document.getElementById("results");

  if (!q) {
    resultsDiv.innerHTML = "";
    return;
  }

  const data = await loadData();

  const results = data.filter(item =>
    item.keywords.some(k => k.toLowerCase().includes(q)) ||
    item.title.toLowerCase().includes(q)
  );

  if (results.length === 0) {
    resultsDiv.innerHTML = "No results found.";
    return;
  }

  resultsDiv.innerHTML = "";
  results.forEach(item => {
    const div = document.createElement("div");
    div.className = "result";

    // Only include the <img> tag if item.image exists and is not empty
    const imgHTML = item.image ? `<img src="${item.image}" style="object-fit:contain">` : "";

    div.innerHTML = `
      ${imgHTML}
      <div class="result-content">
        <strong>${item.title}</strong><br>
        <a href="${item.url}" target="_blank">${item.url}</a><br>
        ${item.description}
      </div>
    `;
    resultsDiv.appendChild(div);
  });
}

// Load data once on page load
loadData();
</script>

</body>
</html>